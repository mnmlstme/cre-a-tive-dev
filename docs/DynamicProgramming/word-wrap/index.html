<!DOCTYPE html>
<html>
<head>
<title>Better Word Wrap for the Web</title>



<script type="importmap">
{ "imports": {"@cre.ative/kram-11ty/runtime":"../../modules/@cre.ative/kram-11ty/runtime.mjs","@cre.ative/kram-11ty/styles":"../../modules/@cre.ative/kram-11ty/styles.css"} }
</script>
  <script type="module" crossorigin src="/assets/index-bda0600d.js"></script>
  <link rel="modulepreload" crossorigin href="/assets/runtime-2607a40c.js">
  <link rel="stylesheet" href="/assets/runtime-40ecf344.css">
</head>
<body>
<kram-main>
<h1 slot="title">Better Word Wrap for the Web</h1>
<kram-toc slot="nav"><ol>
<li data-idref="scene-1">Scene 1</li>
<li data-idref="scene-2">The Greedy algorithm</li>
<li data-idref="scene-3">The (Brute Force) Recursive algorithm</li>
<li data-idref="scene-4">The Memoized (DP) Algorithm</li>
<li data-idref="scene-5">The Tabulation (DP) Algorithm</li>
<li data-idref="scene-6">The testing framework</li>
</ol></kram-toc>
<kram-flow><kram-scene 
        scene="1" 
        language="html" 
        ><kram-code slot="scenecode" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word-wrap</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>25<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  We hold these truths to be self-evident, that all people are created equal,<br>  that they are endowed by their Creator with certain unalienable Rights, that<br>  among these are Life, Liberty and the pursuit of Happiness.<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word-wrap</span><span class="token punctuation">></span></span></code></pre></kram-code><p>The word wrap problem is to optimize the line breaks in a paragraph of text, such that
_ breaks occur only between words
_ no line is longer than a given width, and * minimize the raggedness of the right edge according to some cost function.
Following Knuth&rsquo;s algorithm in TeX, we will build a custom element that improves on the browser&rsquo;s built-in greedy algorithm by applying dynamic programming.</p>

<p>First some simplifying assumptions:</p>

<ol><li><p>monospace font</p>
</li>

<li><p>no hyphenation</p>
</li>

<li><p>all lines equal length</p>
</li>

<li><p>last line not justified</p>
</li>
</ol>

<p>Because we use a monospace font, we don&rsquo;t need to ask the browser for the width of each word. We can also use <code data-mark-around="`">&lt;pre&gt;</code> to display the result.</p>

<p>We will give each line break a cost of <math>s<sup>2</sup></math> where <math>s</math>
is the number of spaces left at the end of the line before the break.</p>

<kram-code data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">lineBreakCost</span><span class="token punctuation">(</span><span class="token parameter">words<span class="token punctuation">,</span> maxWidth<span class="token punctuation">,</span> costFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> slack <span class="token operator">=</span> maxWidth <span class="token operator">-</span> <span class="token function">lineWidth</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token function">costFn</span><span class="token punctuation">(</span>slack<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">lineWidth</span><span class="token punctuation">(</span><span class="token parameter">words</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    words<span class="token punctuation">.</span>length <span class="token operator">-</span><br>    <span class="token number">1</span> <span class="token operator">+</span><br>    words<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">w</span><span class="token punctuation">)</span> <span class="token operator">=></span> w<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> curr</span><span class="token punctuation">)</span> <span class="token operator">=></span> acc <span class="token operator">+</span> curr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">itemizedCosts</span><span class="token punctuation">(</span><span class="token parameter">lines<span class="token punctuation">,</span> maxWidth<span class="token punctuation">,</span> costFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> costs <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">words<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span><br>    i <span class="token operator">===</span> lines<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">lineBreakCost</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> maxWidth<span class="token punctuation">,</span> costFn<span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> totalCost <span class="token operator">=</span> costs<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">makeItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">cost</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    li<span class="token punctuation">.</span>textContent <span class="token operator">=</span> cost<span class="token punctuation">;</span><br>    <span class="token keyword">return</span> li<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> costs<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>totalCost<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>makeItem<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></kram-code></kram-scene>
<kram-scene 
        scene="2" 
        language="html" 
        ><kram-code slot="scenecode" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>The Greedy Algorithm<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word-wrap</span> <span class="token attr-name">algo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>greedy<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>25<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  We hold these truths to be self-evident, that all people are created equal,<br>  that they are endowed by their Creator with certain unalienable Rights, that<br>  among these are Life, Liberty and the pursuit of Happiness.<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word-wrap</span><span class="token punctuation">></span></span></code></pre></kram-code><h2>The Greedy algorithm</h2>

<kram-code data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">wordWrapGreedy</span><span class="token punctuation">(</span><span class="token parameter">words<span class="token punctuation">,</span> maxWidth</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> lines <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> remainingWidth <span class="token operator">=</span> maxWidth<span class="token punctuation">;</span><br><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> w <span class="token keyword">of</span> words<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>lines<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> w<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> remainingWidth<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// keep word on same line</span><br>      lines<span class="token punctuation">[</span>lines<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      remainingWidth <span class="token operator">=</span> remainingWidth <span class="token operator">-</span> w<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>      <span class="token comment">// start new line with word</span><br>      lines<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      remainingWidth <span class="token operator">=</span> maxWidth <span class="token operator">-</span> w<span class="token punctuation">.</span>length<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">return</span> <span class="token function">logSolution</span><span class="token punctuation">(</span><span class="token string">"greedy"</span><span class="token punctuation">,</span> lines<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></kram-code>
<kram-code data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">logSolution</span><span class="token punctuation">(</span><span class="token parameter">algo<span class="token punctuation">,</span> lines<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">=> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>algo<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> Subproblem[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] solved: </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> lines<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> lines<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></kram-code></kram-scene>
<kram-scene 
        scene="3" 
        language="html" 
        ><kram-code slot="scenecode" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>The Recursive (Brute Force) Algorithm<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word-wrap</span> <span class="token attr-name">algo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>brute<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>25<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  We hold these truths to be self-evident, that all people are created equal.<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word-wrap</span><span class="token punctuation">></span></span></code></pre></kram-code><h2>The (Brute Force) Recursive algorithm</h2>

<p>In the brute force algorithm, we do an exhaustive search for the lowest-cost solution.
Whenever we have the option to break or not, we recurse to two subproblems:</p>

<ol><li><p>Break the line, and start the next line with the current word</p>
</li>

<li><p>Insert the word on the current line, and move to the next word.</p>
</li>
</ol>

<p>After computing the costs on each subproblem, compare them and compare the cost of each,
after accounting for the cost of the line break in choice 1.</p>

<kram-code data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">wordWrapBrute</span><span class="token punctuation">(</span><span class="token parameter">words<span class="token punctuation">,</span> maxWidth<span class="token punctuation">,</span> costFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token function">wordWrapRecursive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lines<span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">wordWrapRecursive</span><span class="token punctuation">(</span><br>    <span class="token parameter">wordIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><br>    remainingWidth <span class="token operator">=</span> maxWidth<span class="token punctuation">,</span><br>    currentLine <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><br>  <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> currentWord <span class="token operator">=</span> words<span class="token punctuation">[</span>wordIndex<span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>wordIndex <span class="token operator">===</span> words<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// Base case for last word; fit it if you can</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>currentWord<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> remainingWidth<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// it fits, don't count cost of last line</span><br>        <span class="token keyword">return</span> <span class="token punctuation">{</span><br>          <span class="token literal-property property">cost</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>          <span class="token literal-property property">lines</span><span class="token operator">:</span> <span class="token function">logSolution</span><span class="token punctuation">(</span><br>            <span class="token string">"brute"</span><span class="token punctuation">,</span><br>            <span class="token punctuation">[</span>currentLine<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>currentWord<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>            wordIndex<span class="token punctuation">,</span><br>            remainingWidth<br>          <span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token comment">// it doesn't fit, count cost of broken line</span><br>        <span class="token keyword">return</span> <span class="token punctuation">{</span><br>          <span class="token literal-property property">cost</span><span class="token operator">:</span> <span class="token function">costFn</span><span class="token punctuation">(</span>remainingWidth<span class="token punctuation">)</span><span class="token punctuation">,</span><br>          <span class="token literal-property property">lines</span><span class="token operator">:</span> <span class="token function">logSolution</span><span class="token punctuation">(</span><br>            <span class="token string">"brute"</span><span class="token punctuation">,</span><br>            <span class="token punctuation">[</span>currentLine<span class="token punctuation">,</span> <span class="token punctuation">[</span>currentWord<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>            wordIndex<span class="token punctuation">,</span><br>            remainingWidth<br>          <span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Option 1: start new line with word</span><br>    <span class="token keyword">const</span> withBreak <span class="token operator">=</span> <span class="token function">wordWrapRecursive</span><span class="token punctuation">(</span><br>      wordIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span><br>      maxWidth <span class="token operator">-</span> currentWord<span class="token punctuation">.</span>length<span class="token punctuation">,</span><br>      <span class="token punctuation">[</span>currentWord<span class="token punctuation">]</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> costOfBreak <span class="token operator">=</span> <span class="token function">costFn</span><span class="token punctuation">(</span>remainingWidth<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentWord<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> remainingWidth<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// Current word will fit; we have a choice</span><br>      <span class="token comment">// Option 2: keep word on this line</span><br>      <span class="token keyword">const</span> withoutBreak <span class="token operator">=</span> <span class="token function">wordWrapRecursive</span><span class="token punctuation">(</span><br>        wordIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span><br>        remainingWidth <span class="token operator">-</span> currentWord<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span><br>        currentLine<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>currentWord<span class="token punctuation">]</span><span class="token punctuation">)</span><br>      <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>withoutBreak<span class="token punctuation">.</span>cost <span class="token operator">&lt;=</span> withBreak<span class="token punctuation">.</span>cost <span class="token operator">+</span> costOfBreak<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> withoutBreak<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">return</span> <span class="token punctuation">{</span><br>      <span class="token literal-property property">cost</span><span class="token operator">:</span> withBreak<span class="token punctuation">.</span>cost <span class="token operator">+</span> costOfBreak<span class="token punctuation">,</span><br>      <span class="token literal-property property">lines</span><span class="token operator">:</span> <span class="token function">logSolution</span><span class="token punctuation">(</span><br>        <span class="token string">"brute"</span><span class="token punctuation">,</span><br>        <span class="token punctuation">[</span>currentLine<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>withBreak<span class="token punctuation">.</span>lines<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        wordIndex<span class="token punctuation">,</span><br>        remainingWidth<br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></kram-code></kram-scene>
<kram-scene 
        scene="4" 
        language="html" 
        ><kram-code slot="scenecode" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Dynamic Programming — Memoized Recursive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word-wrap</span> <span class="token attr-name">algo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memo<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>25<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  We hold these truths to be self-evident, that all people are created equal,<br>  that they are endowed by their Creator with certain unalienable Rights, that<br>  among these are Life, Liberty and the pursuit of Happiness.<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word-wrap</span><span class="token punctuation">></span></span></code></pre></kram-code><h2>The Memoized (DP) Algorithm</h2>

<p>Since the brute force algorithm demonstrates both Optimal Substructure and
Overlapping Subproblems, we can use dynamic programming techniques to optimize it</p>

<kram-code data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">wordWrapMemo</span><span class="token punctuation">(</span><span class="token parameter">words<span class="token punctuation">,</span> maxWidth<span class="token punctuation">,</span> costFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> cache <span class="token operator">=</span> words<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">makeMemo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> k<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=></span><br>    <span class="token function">logSolution</span><span class="token punctuation">(</span><span class="token string">"memo"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">fromMemo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> k</span><span class="token punctuation">)</span> <span class="token operator">=></span> cache<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token function">wordWrapRecursive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lines<span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">wordWrapRecursive</span><span class="token punctuation">(</span><br>    <span class="token parameter">wordIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><br>    remainingWidth <span class="token operator">=</span> maxWidth<span class="token punctuation">,</span><br>    currentLine <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><br>  <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> memoized <span class="token operator">=</span> <span class="token function">fromMemo</span><span class="token punctuation">(</span>wordIndex<span class="token punctuation">,</span> remainingWidth<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>memoized<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> memoized<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">const</span> currentWord <span class="token operator">=</span> words<span class="token punctuation">[</span>wordIndex<span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>wordIndex <span class="token operator">===</span> words<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// Base case for last word; fit it if you can</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>currentWord<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> remainingWidth<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// it fits, don't count cost of last line</span><br>        <span class="token keyword">return</span> <span class="token function">makeMemo</span><span class="token punctuation">(</span>wordIndex<span class="token punctuation">,</span> remainingWidth<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>          <span class="token literal-property property">cost</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>          <span class="token literal-property property">lines</span><span class="token operator">:</span> <span class="token punctuation">[</span>currentLine<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>currentWord<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token comment">// it doesn't fit, count cost of broken line</span><br>        <span class="token keyword">return</span> <span class="token function">makeMemo</span><span class="token punctuation">(</span>wordIndex<span class="token punctuation">,</span> remainingWidth<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>          <span class="token literal-property property">cost</span><span class="token operator">:</span> <span class="token function">costFn</span><span class="token punctuation">(</span>remainingWidth<span class="token punctuation">)</span><span class="token punctuation">,</span><br>          <span class="token literal-property property">lines</span><span class="token operator">:</span> <span class="token punctuation">[</span>currentLine<span class="token punctuation">,</span> <span class="token punctuation">[</span>currentWord<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Option 1: start new line with word</span><br>    <span class="token keyword">const</span> withBreak <span class="token operator">=</span> <span class="token function">wordWrapRecursive</span><span class="token punctuation">(</span><br>      wordIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span><br>      maxWidth <span class="token operator">-</span> currentWord<span class="token punctuation">.</span>length<span class="token punctuation">,</span><br>      <span class="token punctuation">[</span>currentWord<span class="token punctuation">]</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> costOfBreak <span class="token operator">=</span> <span class="token function">costFn</span><span class="token punctuation">(</span>remainingWidth<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentWord<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> remainingWidth<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// Current word will fit; we have a choice</span><br>      <span class="token comment">// Option 2: keep word on this line</span><br>      <span class="token keyword">const</span> withoutBreak <span class="token operator">=</span> <span class="token function">wordWrapRecursive</span><span class="token punctuation">(</span><br>        wordIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span><br>        remainingWidth <span class="token operator">-</span> currentWord<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span><br>        currentLine<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>currentWord<span class="token punctuation">]</span><span class="token punctuation">)</span><br>      <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>withoutBreak<span class="token punctuation">.</span>cost <span class="token operator">&lt;=</span> withBreak<span class="token punctuation">.</span>cost <span class="token operator">+</span> costOfBreak<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token function">makeMemo</span><span class="token punctuation">(</span>wordIndex<span class="token punctuation">,</span> remainingWidth<span class="token punctuation">,</span> withoutBreak<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">return</span> <span class="token function">makeMemo</span><span class="token punctuation">(</span>wordIndex<span class="token punctuation">,</span> remainingWidth<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      <span class="token literal-property property">cost</span><span class="token operator">:</span> withBreak<span class="token punctuation">.</span>cost <span class="token operator">+</span> costOfBreak<span class="token punctuation">,</span><br>      <span class="token literal-property property">lines</span><span class="token operator">:</span> <span class="token punctuation">[</span>currentLine<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>withBreak<span class="token punctuation">.</span>lines<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></kram-code></kram-scene>
<kram-scene 
        scene="5" 
        language="html" 
        ><kram-code slot="scenecode" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Dynamic Programming — Tabulation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>word-wrap</span> <span class="token attr-name">algo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tab<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>25<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  We hold these truths to be self-evident, that all people are created equal,<br>  that they are endowed by their Creator with certain unalienable Rights, that<br>  among these are Life, Liberty and the pursuit of Happiness.<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>word-wrap</span><span class="token punctuation">></span></span></code></pre></kram-code><h2>The Tabulation (DP) Algorithm</h2>

<p>The memoized algorithm is fairly natural to express because it can be derived
directly from the recursive solution.
However, in some cases, an alternative formulation called the tabulation method
can be considered a &ldquo;better fit&rdquo; for the application requirements.</p>

<p>In our recursive word wrap algorithm,
the base case&ndash;where the recursion bottoms out&ndash;was the <em data-mark-around="_">last word</em> of the paragraph.
But think about the word processing use case for a moment.
People enter a paragraph of text starting with the first word, not the last word.
If we are writing a WYSIWYG word processor&ndash;or even a text editor with word wrap&ndash;
we want to reprocess the current paragraph every time a new word&ndash;even a new character&ndash;
is entered.</p>

<p>With our previous memoized algorithm, adding a word at the end of an paragraph
which has already been processed, invalidates all cached subproblem results.
The algorithm cannot be applied <em data-mark-around="_">incrementally</em>, and as more words are added,
the time required grows.
In fact the total time spent to process all revisions of the paragraph bumps the
time complexity from O(N^2) to O(N^3).</p>

<p>To solve this, we can reformulate the problem so that its base case is the <em data-mark-around="_">first word</em>
of the paragraph, and each subproblem consists of adding a word at the end.
This way, all the work we do solving smaller subproblems is still valid and
can be used when solving the next larger subproblem.</p>

<p>We start by pre-computing&ndash;and extending as words are added&ndash;a sparse matrix
<math>lc<sub>i, j</sub></math> which maintains the cost of a line containing words <math>i</math>
through <math>j</math>. This matrix is sparse because <math>i &le; j</math> and we can
also exclude any combinations of <math>(i, j)</math> where the words would not fit on one line.</p>

<kram-code data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">computeLineCosts</span><span class="token punctuation">(</span><span class="token parameter">words<span class="token punctuation">,</span> maxWidth<span class="token punctuation">,</span> costFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> lc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> words<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    lc<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> words<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> isLastLine <span class="token operator">=</span> j <span class="token operator">===</span> words<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> k <span class="token operator">=</span> maxWidth <span class="token operator">-</span> <span class="token function">lineWidth</span><span class="token punctuation">(</span>words<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// no more words will fit on the line</span><br>        <span class="token keyword">break</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>      lc<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> isLastLine <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">costFn</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"computeLineCosts: lc="</span><span class="token punctuation">,</span> lc<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> lc<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></kram-code>
<p>With <math>lc</math> computed, we can now compute the solution with optimal cost <math>c<sub>j</sub></math>
for first <math>j</math> words for increasing values of <math>j</math>, using
only the <math>lc</math> values and previous values of <math>c<sub>j</sub></math>.</p>

<p>The idea is that when computing <math>c<sub>j</sub></math>, we need to decide
(optimally) how many words to place on the last line of a paragraph containing
<math>j</math> words.
We already know from <math>lc<sub>i, j</sub></math> the cost of
all possible lines ending with word <math>j</math>.
And we&rsquo;ve already solved <math>c<sub>i</sub></math> for <math>i &le; j</math>,
which we can use to optimally set the previous lines.</p>

<kram-code data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">wordWrapTabular</span><span class="token punctuation">(</span><span class="token parameter">words<span class="token punctuation">,</span> maxWidth<span class="token punctuation">,</span> costFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> lc <span class="token operator">=</span> <span class="token function">computeLineCosts</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> maxWidth<span class="token punctuation">,</span> costFn<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> solution <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">cost</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> solution<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>cost<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token function-variable function">lines</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> solution<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>lines<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// solve for paragraphs with j words, as j increases</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> words<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token comment">// try all values of i for which lc[i][j] is defined</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> j<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> lc<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// cost of putting words i thru j on last line</span><br>      <span class="token comment">// plus the optimal cost for the first i-1 words</span><br>      options<span class="token punctuation">[</span>j <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> i<span class="token punctuation">,</span> <span class="token literal-property property">cost</span><span class="token operator">:</span> lc<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token function">cost</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token comment">// select the minimum cost option</span><br>    <span class="token keyword">const</span> best <span class="token operator">=</span> options<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>cost <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>cost <span class="token operator">?</span> a <span class="token operator">:</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> lastLine <span class="token operator">=</span> words<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>best<span class="token punctuation">.</span>i<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// add the last line to the lines from the previous solution</span><br>    solution<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">logSolution</span><span class="token punctuation">(</span><br>      <span class="token string">"tab"</span><span class="token punctuation">,</span><br>      <span class="token punctuation">{</span><br>        <span class="token literal-property property">lines</span><span class="token operator">:</span> <span class="token function">lines</span><span class="token punctuation">(</span>best<span class="token punctuation">.</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>lastLine<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token operator">...</span>best<span class="token punctuation">,</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      j<br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">return</span> solution<span class="token punctuation">[</span>words<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lines<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></kram-code></kram-scene>
<kram-scene 
        scene="6" 
        language="null" 
        norender><h2>The testing framework</h2>

<kram-code data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>word-wrap-template<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>Input:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">></span></span> <br>      Enter some particularly interesting text here.<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>Output:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>output<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>costing<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>Execution Time:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>timing<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Running…<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>    <span class="token selector">:host</span> <span class="token punctuation">{</span><br>      <span class="token property">--width-to-wrap</span><span class="token punctuation">:</span> 40<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token selector">section</span> <span class="token punctuation">{</span><br>      <span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">;</span><br>      <span class="token property">grid-template-columns</span><span class="token punctuation">:</span> auto 1fr 1fr<span class="token punctuation">;</span><br>      <span class="token property">align-items</span><span class="token punctuation">:</span> baseline<span class="token punctuation">;</span><br>      <span class="token property">gap</span><span class="token punctuation">:</span> 2rem<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token selector">h3</span> <span class="token punctuation">{</span><br>      <span class="token property">grid-column-start</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token selector">pre#input</span> <span class="token punctuation">{</span><br>      <span class="token property">grid-column-end</span><span class="token punctuation">:</span> span 2<span class="token punctuation">;</span><br>      <span class="token property">max-width</span><span class="token punctuation">:</span> 80ch<span class="token punctuation">;</span><br>      <span class="token property">white-space</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token selector">pre#output</span> <span class="token punctuation">{</span><br>      <span class="token property">border</span><span class="token punctuation">:</span> 1px dotted black<span class="token punctuation">;</span><br>      <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--width-to-wrap<span class="token punctuation">)</span> * 1ch<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token property">line-height</span><span class="token punctuation">:</span> 1.5<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token selector">ul</span> <span class="token punctuation">{</span><br>      <span class="token property">list-style</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br>      <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>      <span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span><br>      <span class="token property">width</span><span class="token punctuation">:</span> fit-content<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token selector">li + li:not(:last-child)::before</span> <span class="token punctuation">{</span><br>      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">"+ "</span><span class="token punctuation">;</span><br>      <span class="token property">display</span><span class="token punctuation">:</span> inline<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token selector">li:last-child</span> <span class="token punctuation">{</span><br>      <span class="token property">border-top</span><span class="token punctuation">:</span> 1px solid<span class="token punctuation">;</span><br>      <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre></kram-code>
<kram-code data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">perfRun</span><span class="token punctuation">(</span><span class="token parameter">thunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> start <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> iterations <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">thunk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> time <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    iterations <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    iterations <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> iterations<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">thunk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  time <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span> result<span class="token punctuation">,</span> <span class="token literal-property property">avgTime</span><span class="token operator">:</span> time <span class="token operator">/</span> iterations<span class="token punctuation">,</span> iterations <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></kram-code>
<kram-code data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">WordWrapElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span><br>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"word-wrap-template"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">"open"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> algo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"algo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"output"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> costing <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"costing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> timing <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"timing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>textContent <span class="token operator">||</span> input<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Text input:"</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> words <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Words:"</span><span class="token punctuation">,</span> words<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> fn <span class="token operator">=</span> WordWrapElement<span class="token punctuation">.</span>algorithms<span class="token punctuation">[</span>algo<span class="token punctuation">]</span> <span class="token operator">||</span> wordWrapTabular<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> maxWidth <span class="token operator">=</span> width <span class="token operator">?</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> <span class="token function-variable function">costFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token operator">=></span> k <span class="token operator">*</span> k<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> run <span class="token operator">=</span> <span class="token function">perfRun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> maxWidth<span class="token punctuation">,</span> costFn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> lines <span class="token operator">=</span> run<span class="token punctuation">.</span>result<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> costs <span class="token operator">=</span> <span class="token function">itemizedCosts</span><span class="token punctuation">(</span>lines<span class="token punctuation">,</span> maxWidth<span class="token punctuation">,</span> costFn<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>width<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"--width-to-wrap"</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    output<span class="token punctuation">.</span>textContent <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list</span><span class="token punctuation">)</span> <span class="token operator">=></span> list<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    costing<span class="token punctuation">.</span><span class="token function">replaceChildren</span><span class="token punctuation">(</span><span class="token operator">...</span>costs<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    timing<span class="token punctuation">.</span>textContent <span class="token operator">=</span><br>      run<span class="token punctuation">.</span>iterations <span class="token operator">></span> <span class="token number">1</span><br>        <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>run<span class="token punctuation">.</span>avgTime<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms (avg over </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>run<span class="token punctuation">.</span>iterations<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> runs)</span><span class="token template-punctuation string">`</span></span><br>        <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>run<span class="token punctuation">.</span>avgTime<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">static</span> algorithms <span class="token operator">=</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">greedy</span><span class="token operator">:</span> wordWrapGreedy<span class="token punctuation">,</span><br>    <span class="token literal-property property">brute</span><span class="token operator">:</span> wordWrapBrute<span class="token punctuation">,</span><br>    <span class="token literal-property property">memo</span><span class="token operator">:</span> wordWrapMemo<span class="token punctuation">,</span><br>    <span class="token literal-property property">tab</span><span class="token operator">:</span> wordWrapTabular<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"word-wrap"</span><span class="token punctuation">,</span> WordWrapElement<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></kram-code></kram-scene></kram-flow>
</kram-main>
</body>
</html>
